name: Deploy Hugo site to Pages

on:
  # 在推送到 default 分支 (通常是 main) 時觸發工作流程
  push:
    branches: ["main"]  # <--- 如果您的主要分支是 master，請改成 "master"

  # 允許您從 GitHub Actions 頁面手動觸發此工作流程
  workflow_dispatch:

# 設定 GITHUB_TOKEN 的權限，以允許部署到 GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# 只允許一個部署並行，取消正在進行中的部署之間排隊的運行。
# 但是，不要取消正在進行中的運行，因為我們希望允許這些生產部署完成。
concurrency:
  group: "pages"
  cancel-in-progress: false

# 預設使用 bash
defaults:
  run:
    shell: bash

jobs:
  # 建置工作
  build:
    runs-on: ubuntu-latest # 使用最新的 Ubuntu 虛擬環境
    env:
      HUGO_VERSION: 0.111.3 # 指定一個較新的 Hugo 版本，您可以修改為您本地使用的版本
    steps:
      - name: Install Hugo CLI # 安裝 Hugo
        run: |
          wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb \
          && sudo dpkg -i ${{ runner.temp }}/hugo.deb
      - name: Checkout # 拉取您的原始碼
        uses: actions/checkout@v4
        with:
          submodules: recursive # 如果您的主題是 Git Submodule，這會一起拉取
          # fetch-depth: 0 # 如果需要完整的 Git 歷史 (例如 .Lastmod)，取消註釋

      - name: Setup Pages # 設定 GitHub Pages 環境
        id: pages
        uses: actions/configure-pages@v5

      - name: Build with Hugo # 使用 Hugo 建置網站
        env:
          # 設定 Hugo 環境為 production，確保使用 baseURL 等生產配置
          HUGO_ENVIRONMENT: production
          HUGO_ENV: production
        run: |
          # 使用 configure-pages action 提供的 base URL 來建置
          # --minify 可選，用於壓縮輸出檔案
          hugo --minify --baseURL "${{ steps.pages.outputs.base_url }}/"
          # 注意: 對於專案頁面，baseURL 末尾的 / 很重要

      - name: Upload artifact # 上傳建置好的網站檔案 (public 目錄)
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public # Hugo 預設的輸出目錄

  # 部署工作
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }} # 部署完成後的網址
    runs-on: ubuntu-latest
    needs: build # 需要先完成 build 工作
    steps:
      - name: Deploy to GitHub Pages # 執行部署
        id: deployment
        uses: actions/deploy-pages@v4 # 使用官方的部署 action